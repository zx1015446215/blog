<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
<title>Zx的博客</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="keywords" content="" />
<script type="application/x-javascript"> addEventListener("load", function() { setTimeout(hideURLbar, 0); }, false); function hideURLbar(){ window.scrollTo(0,1); } </script>
<link href="/css/bootstrap.min.css" rel="stylesheet">
<link href="/css/button.css" rel="stylesheet">
<link href="/css/bootstrap.css" type="text/css" rel="stylesheet" media="all">
<link href="/css/style1.css" type="text/css" rel="stylesheet" media="all">
<link rel="stylesheet" href="/css/flexslider.css" type="text/css" media="all" property="" />
<link href="/css/font-awesome.css" rel="stylesheet"> 			<!-- font-awesome icons -->
<link href="/css/comment.css" rel="stylesheet">
<link href="/css/owl.carousel.css" rel="stylesheet" type="text/css" media="all">
<link rel="stylesheet" href="/css/login.css" />
<script src="/js/jquery-2.2.3.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/smoothscroll.min.js"></script>

<style>
	.con{
		padding-right: 15px;
		padding-left: 15px;
	}
	.content{
		color: #1d1d1d;
	}
	.a{
		margin-top: 15%;
		margin-left: 40%;
	}
	.authorsize{
		font-size: 21px;
	}
</style>
</head>
<body>
<!-- banner -->
<div class="banner" th:fragment="navbar">
	<!-- header -->
	<div class="header">
		<div class="container">
			<div class="header-w3lsrow">
				<div class="menu">
					<div class="toggle"></div>
					<ul class="w3nav">
						<li><a href="/blog" class="active"> 主页</a></li>
						<li><a href="/blog/open/page/communication">交流</a></li>
						<!--<li><a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Short Codes <span class="caret"></span></a>-->
							<!--<ul class="dropdown-menu">-->
								<!--<li><a href="http://www.baidu.com">测试1</a></li>-->
								<!--<li><a href="http://www.hao123.com">测试2</a></li>-->
							<!--</ul>-->
						<!--</li>-->
					</ul>
					<div class="clearfix"> </div>
				</div>

				<div class="logo">
					<h1><a>Zx的博客</a></h1>
				</div>
				<div class="header-right">
					<ul>
						<li><a href="/index/login">SignIn</a></li>
						<li><a id="Regist_start_">SignUp</a></li>
					</ul>
					<div class="clearfix"> </div>
				</div>
				<div class="clearfix"> </div>
			</div>
		</div>
	</div>
	<!-- 会员注册 -->
	<div class="a" th:fragment="navbar">
		<div id='regist_container' style="display: none;">
			<div id="lab1">
				<span id="lab_login">会员注册</span>
				<span id="lab_toLogin">
						&emsp;已有账号&nbsp;
						<a href="/index/login">立即登录</a>
					</span>
			</div>
			<div id="form_container2" style="padding-top: 25px;">

				<input type="text" class="form-control" value="admin"  placeholder="用户名" id="username"/>
				<input type="password" class="form-control" placeholder="密码" id="password" />
				<input type="password" class="form-control" placeholder="确认密码" id="sure_pass" />
				<input type="text" class="form-control" placeholder="邮箱" id="email" />
				<input type="text" class="form-control" placeholder="验证码" id="code" />
				<input id="regis_code" type="button" class="btn btn-success" value="点击发送验证码" />
			    <input type="button" value="注册" class="btn btn-success" id="regis_btn" />
			</div>
		</div>
	</div>
		<!-- banner-text -->
		<div class="banner-text"> 
			<div class="container">
				<div class="flexslider">
					<ul class="slides">
						<li>
							<div class="banner-w3lstext">
								<h2>Welcome</h2>
								<p>无论我做什么，我都想成为那个我</p>
								<p>Whatever I do, I want to be me</p>
							</div>
						</li>
						<li>
							<div class="banner-w3lstext">
								<h3>No End</h3>
								<p>如果你不给自己设限，世界上便没有限制你发挥的篱笆</p>
								<p>If you don't set limits on yourself, there's no fence in the world that limits you</p>
							</div>
						</li>
						<li>
							<div class="banner-w3lstext">
								<h3>Life</h3>
								<p>我不是没脾气，只是不轻易发脾气。我不是不爱你，只是放在心里而已</p>
								<p class="">I did not temper, but not easily loses his temper.I'm not love you, just put in the heart just</p>
							</div>
						</li>
					</ul> 
				</div> 	
				<script defer src="/js/jquery.flexslider.js"></script>
				<script type="text/javascript">
					$(window).load(function(){
					  $('.flexslider').flexslider({
						animation: "slide",
						start: function(slider){
						  $('body').removeClass('loading');
						}
					  });
					});
				</script>
			</div>
		</div>
	</div>
<br/><br/>
<!-- Main Content -->
	<div id="inhere" class="container">
		<div class="row">
			<div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
				<!--加载内容 -->
				<div id="incomeNum"></div>

				<div class="clearfix">
					<p id="flagLoaded" style="display: none; text-align: center;">已全部加载</p>
					<a id="flagLoad" style="display: none;" class="btn btn-secondary float-right"
					   href="javascript:void(0)" onclick="nextPage()">更早 &rarr;</a>
				</div>
			</div>
		</div>
	</div>

<div id="commentContainer" class="container"  style="display: none">
	<div class="commentbox">
		<textarea cols="80" rows="50" placeholder="来说几句吧......" class="mytextarea" id="content"></textarea>
		<div class="btn btn-info pull-right" id="comment">评论</div>
	</div>
	<div id="loadComment" class="comment-list">
		//动态添加恢复内容

	</div>
</div>
	<!--页面加载更快-->
    <script src="/js/bootstrap.js"></script>
</body>
<script type="text/javascript">
    var limit = 10;
    var currentPage = 0;
    var total;
    $(function(){
        bindList(0);

    });

    function nextPage() {
        bindList(currentPage * limit)
    }
    //获取文章信息并动态加载
    function LoadSingleArticle(cid) {
        $.ajax({
            url: 'http://localhost:8884/blog/open/post/' + cid,
            type: 'get',
            dataType: 'json',
            success: function (article) {
                var htmlText = "";
                htmlText += '<div class="bg">';
                htmlText += '<div class="article"><br/>';
                htmlText += '<h1 align="center">' + article.title + '</h1><br/>';
                htmlText += '<div><label>作者: </label>';
                htmlText += '<a>&nbsp;' + article.author + '</a>';
                htmlText += '</div>';
                htmlText += '<div><label>时间: </label>';
                htmlText += '<a>&nbsp;' + article.gtm_modified + '</a>';
                htmlText += '</div>';
                htmlText += '<div><label>内容: </label>';
                htmlText += '<p class="content">' + article.content + '</p>';
                htmlText += '</div>';
                htmlText += '</div>';
                htmlText += '<br/>';
                htmlText += '<br/>';
                htmlText += '</div>';
                $("#inhere").html("");
                $("#inhere").append(htmlText);
                document.getElementById("inhere").className = "con";
                getComment(cid);
            }
        });
    }

    //存储父节点为0的回复
    $("#comment").on('click',function(){
        var content = $("#content").val();
        var parent_id = 0;
        $.ajax({
            url : 'http://localhost:8884/comment/saveComment',
            type : 'get',
            dataType : 'json',
			data : {
                parent_id :parent_id,
				content : content
			},
            success : function(){
                alert("成功");
            }
        });
	});




    // 获取文章评论信息并动态加载
    function getComment(cid){
        document.getElementById("commentContainer").style.display = "block";
        $.ajax({
            url : 'http://localhost:8884/comment/list/'+cid,
            type : 'get',
            dataType : 'json',
            success : function(rows) {
                //解析List<Tree<Comment>>
				alert("length:"+rows.length);
                var htmlText = "";
                for (i = 0; i < rows.length; i++) {
                    //rows[i]  等价于Tree<Comment>
					var map = rows[i].attributes;
                    htmlText += '<div class="comment-info">';
                    htmlText += '<header><img src="./images/img.jpg"></header>';
                    htmlText += '<div class="comment-right">';
                    htmlText += '<h3>'+map["user_id"]+'</h3>';   //id
                    htmlText += '<div class="comment-content-header">';
                    htmlText += '<span><i class="glyphicon glyphicon-time"></i>'+map["date"]+'</span>';  //时间
                    htmlText += '</div>';
                    htmlText += '<p class="content">'+rows[i].text+'</p>';       //评论内容
                    htmlText += '<div class="comment-content-footer">';
                    htmlText += '<div class="row">';
                    htmlText += '<div class="col-md-10">';
                    htmlText += '</div>';
                    // htmlText += '<div class="col-md-2"><span class="reply-btn">回复</span>';
                    // htmlText += '</div>';
                    htmlText += '</div>';
                    htmlText += '</div>';
                    //开始子节点
                    htmlText += '<div class="reply-list">';
                    if(rows[i].hasChildren == true){
                        //此处的child等价于List<Tree<T>>
                        var child = rows[i].children;
                        for(j=0;j<child.length;j++){
                            var attr = child[j].attributes;
                            //一个小子节点
                            htmlText += '<div class="reply">';
                            htmlText += '<div><a href="javascript:void(0)">'+attr["user_id"]+'</a>:';
                            htmlText += '<span>'+child[j].text+'</span>';
                            htmlText += '</div>';
                            htmlText += '<p><span>'+attr["date"]+'</span>';
                            // htmlText += '<span class="reply-list-btn">回复</span></p>';
							htmlText += '</p>';
                            //结束一个小子节点
                            htmlText += '</div>';
						}
					}
                    //结束子节点
                    htmlText += '</div>';
                    htmlText += '</div>';
                }
                $("#loadComment").html("");
                $("#loadComment").append(htmlText);
            }
        });
    }

    function bindList(offset) {
        $.ajax({
            // url : 'http://47.106.213.88:8884/blog/open/list?type=1&limit=10&offset=' + offset,
            url : 'http://localhost:8884/blog/open/list?type=1&limit=10&offset=' + offset,
            type : 'get',
            dataType : 'json',
            success : function(data) {
                var rows = data.rows;
                total = data.total;
                var htmlText = "";
                for (i = 0; i < rows.length; i++) {
                    htmlText += '<div class="post-preview">';
                    htmlText += '<a>';
                    htmlText += '<h2 class="post-title">';
                    htmlText += rows[i].title;
                    htmlText += '</h2>';
                    htmlText += '</a>';
                    htmlText += '<p class="authorsize">作者：<a href="#">'
                        + rows[i].author
                        + '</a> &nbsp;&nbsp; '
                        + rows[i].gtm_modified + '</p>';
                    htmlText += '<div><input type="button" onclick="'+'LoadSingleArticle('+rows[i].cid+')'+'" class="btn size-L btn-primary radius" value="更多内容"></div>';
                    htmlText += '</div>';
                    htmlText += '<hr>';
                }
                $("#incomeNum").append(htmlText);
                document.getElementById("flagLoad").style.display = "block";
                currentPage++;
                if (total <= currentPage * limit) {
                    document.getElementById("flagLoaded").style.display = "block";
                    document.getElementById("flagLoad").style.display = "none";
                }
            }
        });
    }
</script>
<!-- menu js -->
<script>
    $('.toggle').on('click', function() {
        $('.menu').toggleClass('open');
        $('.w3nav').toggleClass('show-w3nav');
        $('.w3nav a').toggleClass('show-w3nav-link');
        $('.toggle').toggleClass('close');
    });






    // $(function(){
    //     // $(".comment-list").addCommentList({data:arr,add:""});
    //     $("#comment").click(function(){
    //         var obj = new Object();
    //         obj.img="./images/img.jpg";
    //         obj.replyName="匿名";
    //         obj.content=$("#content").val();
    //         obj.browse="深圳";
    //         obj.osname="win10";
    //         obj.replyBody="";
    //         $(".comment-list").addCommentList({data:[],add:obj});
    //     });
    // })
</script>
<!-- //menu js -->
<script src="/js/owl.carousel.js"></script>
<script src="/js/register.js"></script>
<script src="/js/sendCode.js"></script>
</html>