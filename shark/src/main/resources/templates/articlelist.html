<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
<meta charset="UTF-8">
<title>个人博客列表</title>
<link href="/css/book.css" rel="stylesheet">
<link href="/css/button.css" rel="stylesheet">
<link href="/css/form.css" rel="stylesheet">
<style>
    .a{
        width: 300px;
        height: 30px;
        margin-left: auto;
    }
</style>
<script src="/js/jquery.min.js?v=2.1.4"></script>
<script>
    // const addArticleUrl='http://47.106.213.88:8884/article/addArticle',
    //     updateArticleUrl='http://47.106.213.88:8884/article/updateArticle';
    const addArticleUrl='http://localhost:8884/article/addArticle',
        updateArticleUrl='http://localhost:8884/article/updateArticle';
function addArticleform() {
    $('.login-form-mask').fadeIn(100);
    $('.login-form').slideDown(200);
}
function closeArticleform() {
    $('.login-form-mask').fadeOut(100);
    $('.login-form').slideUp(200);
}

/**
 * 添加文章
 */
function addArticle() {
    var title = document.getElementById("title");
    var author = document.getElementById("author");
    var type = document.getElementById("articlecategories");
    var content = document.getElementById("content").value;
    content = content.replace(/\r\n/g, '<br/>'); //IE9、FF、chrome
    content = content.replace(/\n/g, '<br/>'); //IE7-8
    content = content.replace(/\s/g, ' '); //空格处理
    $.ajax({
        url: addArticleUrl,
        type: "POST",
        datatype: "json",
        data: {
            title : title.value,
            author : author.value,
            categories : type.value,
            content : content
        },
        error: function(e) {
            console.log("error", e.statusText);
            alert("插入失败");
        },
        success: function(res) {
            location.reload();
        },
        complete: function(d) {
            console.log("done");
        }
    });
}
   /**
    * 确认修改文章
    */
    function makeSureUpdateAriticle(cid,title,autho) {
       var btn = document.getElementById(cid);
       var m = document.getElementsByName(cid).item(0).getElementsByTagName("input");
       var n = document.getElementsByName(cid).item(0).getElementsByTagName("textarea");
       var title = m[0].value,
           author = m[1].value,
           categories = m[2].value,
           content = n[0].value;
       content = content.replace(/\r\n/g, '<br/>'); //IE9、FF、chrome
       content = content.replace(/\n/g, '<br/>'); //IE7-8
       content = content.replace(/\s/g, ' '); //空格处理
       $.ajax({
            url : updateArticleUrl,
            type : 'post',
           datatype: "json",
            data : {
                cid : cid ,
                title: title ,
                categories: categories ,
                author: author,
                content: content
            },
            error: function (e) {
                alert("修改失败");
            },
            success: function (res) {
                btn.value="修改";   //改变值
                btn.onclick = function (ev) {   //改变动作
                    updateArticle(cid);
                };
                alert("修改成功");
                location.reload();
            },
            complete: function(d) {
                console.log("done");
            }
        });
    }
/**
 * 修改文章
 */
function updateArticle(cid) {
    var btn = document.getElementById(cid);
    var b = $("input[type='button'][id='"+cid+"']").parent();  //td
    var a = b.siblings();  //获取td的兄弟节点
    a[0].innerHTML="<input type='text' value='"+a[0].innerText+"'/>";
    a[1].innerHTML="<input type='text' value='"+a[1].innerText+"'/>";
    a[2].innerHTML="<textarea cols='40' rows='5'>"+a[2].innerText+"</textarea>";
    a[3].innerHTML="<input type='text' value='"+a[3].innerText+"'/>";
    btn.value="确认";   //改变值
    btn.onclick = function (ev) {   //改变动作
        makeSureUpdateAriticle(cid);
    };
}
</script>
</head>
<body>
<table id="mytable" border="1"  class="table table-border table-bordered table-striped">
    <tr >
        <td hidden="hidden">cid</td>
        <td>标题</td>
        <td>作者</td>
        <td>内容</td>
        <td>分类</td>
        <td>评论数量</td>
        <td>状态</td>
        <td>创建时间</td>
        <td>最近修改时间</td>
        <td>操作</td>
    </tr>
    <tbody id="tbody">

    <tr th:name="${content.cid}" th:each="content : ${contents}" th:class="active">
        <!--<td><input type="checkbox" name="checkbook" th:value="${book.id}"></td>-->
        <!--<td th:text="${book.id}" hidden="hidden">1</td>-->
        <td th:text="${content.title}">0</td>
        <td th:text="${content.author}">1</td>
        <td th:text="${content.content}">2</td>
        <td th:text="${content.categories}">3</td>
        <td th:text="${content.comments_num}">4</td>
        <td th:text="${content.status} eq 1 ? 已发布 : 未发布">5</td>
        <td th:text="${content.gtm_create}">6</td>
        <td th:text="${content.gtm_modified}">7</td>
        <td><input th:id="${content.cid}"  type="button" class="btn btn-success" onclick="updateArticle(this.id)" value="修改" />
        </td>
    </tr>
    <th><input type="button" onclick="addArticleform()" class="btn size-L btn-primary radius" value="添加书籍"></th>
    </tbody>
</table>
<!--书籍的存入表单-->
<div class="login-form" align="center">
    <div class="login-header">
        <a href="javascript:;"title="关闭" onclick="closeArticleform()" class="login-close close">×</a>
        <h3 class="loginlabel">添加文章</h3>
    </div>
    <div class="col-md-10 col-md-offset-1 col-sm-10 col-sm-offset-1 col-xs-10 col-xs-offset-1">
        <table id="addarticle">
            <p><label>标题:</label>
                <input type="text" id="title" class="a"></p>
            <p><label>作者:</label>
                <input type="text" id="author" class="a"></p>
            <p><label>内容:</label>
                <!--<input type="" id="content" class="a"></p>-->
                <textarea id="content" cols="40" rows="5"></textarea>
            </p>
            <p><label>分类:</label>
                <select id="articlecategories" class="a">
                    <option value="essay">随笔</option>
                    <option value="article">IT</option>
                    <option value="novel">小说</option>
                </select></p>
            <input type="submit" class="btn btn-success radius" onclick="addArticle()"  value="添加">
        </table>
    </div>
</div>
<div class="login-form-mask"></div>
</body>

</html>